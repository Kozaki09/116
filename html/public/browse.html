<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse</title>
    <link rel="stylesheet" href="/css/general.css"> <!-- General styles -->
    <link rel="stylesheet" href="/css/browse.css"> <!-- Specific styles for dashboard page -->
    <link rel="stylesheet" href="/css/sidebar.css"> <!-- Specific styles for login/create page -->
</head>
<body>
    <dib id="sidebar-container"></dib>

    <div class="content">
        <h1>Browse</h1>
        <div id="loading" class="loading">Loading books...</div>

    <table id="booksTable" style="display: none;">
        <thead>
            <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Publisher</th>
                <th>Year</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be inserted here -->
        </tbody>
    </table>

    <script>// Function to load the sidebar dynamically
        async function loadSidebar() {
            try {
                const response = await fetch('/public/sidebar.html');
                const sidebarHTML = await response.text();

                // Insert sidebar HTML into the container
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;
            } catch (error) {
                console.error('Error loading the sidebar:', error);
            }
        }

        async function fetchPublicBooks() {
        try {
            const response = await fetch('/get/public_books');  // The route to get the public books

            if (!response.ok) {
                throw new Error(`Failed to fetch books. Status: ${response.status}`);
            }

            const books = await response.json();  // Assuming books is an array

            if (!Array.isArray(books)) {
                throw new Error('Expected books to be an array.');
            }

            // Hide loading message and show the table
            document.getElementById('loading').style.display = 'none';
            document.getElementById('booksTable').style.display = 'table';

            // Get the table body
            const tableBody = document.querySelector('#booksTable tbody');
            tableBody.innerHTML = ''; 

            // Insert each book as a new row in the table
            books.forEach(book => {
                const row = document.createElement('tr');

                const titleCell = document.createElement('td');
                const titleLink = document.createElement('a');
                titleLink.textContent = book.title;
                titleLink.href = `get/book?book_id=${book.id}`;
                titleCell.appendChild(titleLink);

                const authorCell = document.createElement('td');
                authorCell.textContent = book.auth_name
                const authorLink = document.createElement('a');
                authorLink.textContent - book.auth_name;
                authorLink.href = `get/author?auth_name=${book.auth_name}`;
                authorCell.appendChild(authorLink);

                const publisherCell = document.createElement('td');
                publisherCell.textContent = book.publisher; 

                const yearCell = document.createElement('td');
                yearCell.textContent = book.publication;

                row.appendChild(titleCell);
                row.appendChild(authorCell);
                row.appendChild(publisherCell);
                row.appendChild(yearCell);

                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching public books:', error);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    }

        // Call the fetchPublicBooks function when the page loads
        fetchPublicBooks();
        loadSidebar();
    </script>

</body>
</html>